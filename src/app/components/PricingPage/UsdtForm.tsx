'use client';

import Image from 'next/image';
import { useEffect, useState } from 'react';
import { cn } from '~/helpers';
import { QRCodeSVG } from 'qrcode.react';
import FormContainer from '../shared/FormContainer';
import BackIcon from '../AuthPage/assets/back_icon';
import CopyButton from '../shared/CopyButton/CopyButton';

interface StudentFormProps {
  onClose: () => void;
}

export default function UsdtForm({ onClose }: StudentFormProps) {
  const [formState, setFormState] = useState<'input' | 'success'>('input');

  const trc20Address = 'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t'; // Recipient's TRON address
  const amount = 1000000; // Amount in smallest unit (e.g., 1 USDT = 1000000)

  const paymentUri = `tron:${trc20Address}?amount=${amount}`;
  const [isCopied, setIsCopied] = useState(false);

  const handleCopy = () => {
    navigator.clipboard.writeText(trc20Address);
    setIsCopied(true);
  };

  useEffect(() => {
    if (isCopied) {
      setTimeout(() => {
        setIsCopied(false);
      }, 2000);
    }
  }, [isCopied]);

  const handleSubmit = () => {
    setFormState('success');
  };

  return (
    <FormContainer
      onClose={onClose}
      title="Оплата курса"
      description="Мы создали для вас уникальный QR-код и адрес для осуществления оплаты курса"
      submitButtonText="Ищем транзакцию"
      submitDisabled={false}
      onSubmit={handleSubmit}
      formState={formState}
      successTitle="Тариф оплачен"
      successDescription="Выбранный тариф успешно оплачен. Желаем вам приятного обучения!"
      showBackButton={formState === 'input'}
      bottomText={{
        main: 'Не прошла оплата?',
        secondary: 'Напишите нам',
        link: 'https://t.me/form_support',
      }}
      onBackClick={onClose}
    >
      <div className="flex flex-1 flex-col gap-6">
        <div className="relative flex h-63.75 w-87.5 flex-col items-center justify-center gap-4 sm:h-82 sm:w-85">
          <div className="bg-foreground flex h-45 w-45 items-center justify-center rounded-3xl p-4 sm:h-50 sm:w-50 sm:p-5">
            <QRCodeSVG
              value={paymentUri}
              size={200}
              fgColor="#01050d"
              bgColor="#f2f2f2"
              level="L" // Error correction level
              className="h-full w-full"
            />
          </div>
          <svg
            width="340"
            height="328"
            viewBox="0 0 340 328"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            className="absolute hidden h-82 w-85 sm:block"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M14.4 8H60V9H14.4C11.378 9 9.19174 9.00137 7.49535 9.18517C5.81768 9.36693 4.73811 9.71744 3.88553 10.3369C3.29127 10.7686 2.76866 11.2912 2.33691 11.8855C1.71747 12.7381 1.36696 13.8177 1.18519 15.4953C1.0014 17.1917 1.00003 19.3779 1.00003 22.4V63.9417H2.57897e-05V22.4C2.57897e-05 16.4004 2.57897e-05 13.4006 1.52789 11.2977C2.02133 10.6186 2.61859 10.0213 3.29774 9.52786C5.40067 8 8.40045 8 14.4 8ZM0 271L2.57897e-05 313.6C2.57897e-05 319.6 2.57897e-05 322.599 1.52789 324.702C2.02133 325.381 2.61859 325.979 3.29774 326.472C5.40067 328 8.40045 328 14.4 328H325.6C331.6 328 334.599 328 336.702 326.472C337.381 325.979 337.979 325.381 338.472 324.702C340 322.599 340 319.6 340 313.6L340 271H339V313.6C339 316.622 338.999 318.808 338.815 320.505C338.633 322.182 338.283 323.262 337.663 324.115C337.231 324.709 336.709 325.231 336.115 325.663C335.262 326.283 334.182 326.633 332.505 326.815C330.808 326.999 328.622 327 325.6 327H280V327.941H60V327H14.4C11.378 327 9.19174 326.999 7.49535 326.815C5.81768 326.633 4.73811 326.283 3.88553 325.663C3.29127 325.231 2.76866 324.709 2.33691 324.115C1.71747 323.262 1.36696 322.182 1.18519 320.505C1.0014 318.808 1.00003 316.622 1.00003 313.6V271H0ZM339 63.9416H340L340 22.4C340 16.4004 340 13.4006 338.472 11.2977C337.979 10.6186 337.381 10.0213 336.702 9.52786C334.599 8 331.6 8 325.6 8H280V9H325.6C328.622 9 330.808 9.00137 332.505 9.18517C334.182 9.36693 335.262 9.71744 336.115 10.3369C336.709 10.7686 337.231 11.2912 337.663 11.8855C338.283 12.7381 338.633 13.8177 338.815 15.4953C338.999 17.1917 339 19.3779 339 22.4V63.9416Z"
              fill="#282D33"
            />
            <path
              d="M129.204 9.036H130.272C130.416 10.392 131.328 11.184 132.816 11.184C134.088 11.184 134.868 10.608 134.868 9.684C134.868 8.58 133.8 8.352 132.432 8.076C130.968 7.788 129.408 7.44 129.408 5.724C129.408 4.248 130.548 3.276 132.408 3.276C134.46 3.276 135.66 4.536 135.792 6.18H134.712C134.592 5.088 133.776 4.236 132.384 4.236C131.256 4.236 130.488 4.836 130.488 5.688C130.488 6.708 131.616 6.936 132.852 7.188C134.436 7.5 135.948 7.848 135.948 9.612C135.948 11.208 134.628 12.144 132.792 12.144C130.62 12.144 129.288 10.848 129.204 9.036ZM136.614 8.76C136.614 6.756 137.85 5.388 139.746 5.388C141.306 5.388 142.422 6.324 142.722 7.776H141.642C141.402 6.876 140.742 6.324 139.746 6.324C138.438 6.324 137.67 7.296 137.67 8.76C137.67 10.224 138.438 11.208 139.758 11.208C140.802 11.208 141.474 10.584 141.678 9.6H142.758C142.494 11.136 141.354 12.144 139.734 12.144C137.85 12.144 136.614 10.764 136.614 8.76ZM144.42 10.26C144.42 10.932 144.972 11.244 145.776 11.244C147.096 11.244 147.96 10.416 147.96 9.336V8.868L145.656 9.276C144.72 9.444 144.42 9.756 144.42 10.26ZM143.34 10.308C143.34 9.288 144.012 8.688 145.512 8.424L147.96 8.004V7.944C147.96 6.888 147.336 6.324 146.256 6.324C145.2 6.324 144.612 6.864 144.468 7.764H143.412C143.544 6.372 144.564 5.388 146.28 5.388C148.008 5.388 149.016 6.384 149.016 8.028V12H148.08L148.044 10.968C147.66 11.64 146.676 12.144 145.536 12.144C144.24 12.144 143.34 11.496 143.34 10.308ZM150.084 12V5.532H151.02L151.056 6.696C151.392 5.868 152.16 5.388 153.18 5.388C154.62 5.388 155.508 6.324 155.508 7.836V12H154.476V8.22C154.476 6.972 153.972 6.324 152.952 6.324C151.848 6.324 151.116 7.08 151.116 8.22V12H150.084ZM158.68 7.716C158.68 4.992 160.324 3.276 162.796 3.276C165.292 3.276 166.936 4.992 166.936 7.716C166.936 9.252 166.42 10.452 165.532 11.208L166.828 12.912H165.484L164.716 11.748C164.152 12 163.516 12.144 162.796 12.144C160.324 12.144 158.68 10.44 158.68 7.716ZM159.76 7.716C159.76 9.852 160.972 11.184 162.796 11.184C164.644 11.184 165.856 9.852 165.856 7.716C165.856 5.556 164.632 4.236 162.796 4.236C160.984 4.236 159.76 5.568 159.76 7.716ZM167.945 12V3.42H171.617C173.561 3.42 174.569 4.344 174.569 5.928C174.569 7.2 173.909 8.04 172.649 8.316L174.821 12H173.609L171.581 8.424H168.977V12H167.945ZM168.977 7.464H171.545C172.841 7.464 173.489 7.02 173.489 5.928C173.489 4.836 172.829 4.38 171.545 4.38H168.977V7.464ZM175.465 9.048V8.112H179.641V9.048H175.465ZM180.501 7.716C180.501 4.992 182.097 3.276 184.497 3.276C186.537 3.276 187.989 4.464 188.385 6.456H187.281C186.933 5.052 185.913 4.236 184.485 4.236C182.745 4.236 181.581 5.568 181.581 7.716C181.581 9.852 182.745 11.184 184.497 11.184C185.985 11.184 187.029 10.272 187.329 8.748H188.433C188.109 10.872 186.633 12.144 184.497 12.144C182.097 12.144 180.501 10.44 180.501 7.716ZM190.205 8.76C190.205 10.224 190.985 11.208 192.293 11.208C193.601 11.208 194.369 10.224 194.369 8.76C194.369 7.308 193.601 6.324 192.293 6.324C190.985 6.324 190.205 7.308 190.205 8.76ZM189.149 8.76C189.149 6.756 190.397 5.388 192.293 5.388C194.189 5.388 195.425 6.756 195.425 8.76C195.425 10.764 194.189 12.144 192.293 12.144C190.397 12.144 189.149 10.764 189.149 8.76ZM201.185 8.748C201.185 7.236 200.417 6.324 199.145 6.324C197.897 6.324 197.201 7.2 197.201 8.76C197.201 10.32 197.897 11.208 199.145 11.208C200.417 11.208 201.185 10.272 201.185 8.748ZM202.193 12H201.257L201.221 10.896C200.837 11.724 199.937 12.144 198.989 12.144C197.285 12.144 196.145 10.788 196.145 8.772C196.145 6.756 197.285 5.388 198.989 5.388C199.937 5.388 200.765 5.808 201.161 6.564V3.18H202.193V12ZM203.106 8.76C203.106 6.756 204.33 5.388 206.202 5.388C208.026 5.388 209.238 6.684 209.238 8.604V9.12H204.174C204.294 10.38 205.038 11.208 206.238 11.208C207.15 11.208 207.774 10.74 208.05 9.96H209.142C208.77 11.292 207.69 12.144 206.214 12.144C204.33 12.144 203.106 10.764 203.106 8.76ZM204.198 8.256H208.158C208.038 7.08 207.354 6.324 206.214 6.324C205.074 6.324 204.354 7.08 204.198 8.256Z"
              fill="url(#paint0_linear_2008_35882)"
            />
            <defs>
              <linearGradient
                id="paint0_linear_2008_35882"
                x1="135.451"
                y1="21.9231"
                x2="204.122"
                y2="-22.7312"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#F46919" />
                <stop offset="1" stop-color="#F419AB" />
              </linearGradient>
            </defs>
          </svg>

          <svg
            width="350"
            height="255"
            viewBox="0 0 350 255"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            className="absolute block h-63.75 w-87.5 sm:hidden"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M335.6 6H310V5H335.6C341.6 5 344.599 5 346.702 6.52786C347.381 7.0213 347.979 7.61856 348.472 8.29772C350 10.4006 350 13.4004 350 19.4V45H349V19.4C349 16.3779 348.999 14.1917 348.815 12.4953C348.633 10.8177 348.283 9.73809 347.663 8.8855C347.231 8.29124 346.709 7.76864 346.115 7.33688C345.262 6.71744 344.182 6.36693 342.505 6.18517C340.808 6.00137 338.622 6 335.6 6ZM1.00001 45V19.4C1.00001 16.3779 1.00139 14.1917 1.18518 12.4953C1.36694 10.8177 1.71746 9.73809 2.33689 8.8855C2.76865 8.29124 3.29125 7.76864 3.88552 7.33688C4.7381 6.71744 5.81767 6.36693 7.49534 6.18517C9.19173 6.00137 11.378 6 14.4 6H40V5H14.4C8.40044 5 5.40066 5 3.29773 6.52786C2.61857 7.0213 2.02131 7.61856 1.52788 8.29772C1.38456e-05 10.4006 1.38456e-05 13.4004 1.38456e-05 19.4L0 45H1.00001ZM7.15228e-06 215L1.38456e-05 240.6C1.38456e-05 246.6 1.38456e-05 249.599 1.52788 251.702C2.02131 252.381 2.61857 252.979 3.29773 253.472C5.40066 255 8.40044 255 14.4 255H40V254H14.4C11.3779 254 9.19173 253.999 7.49534 253.815C5.81767 253.633 4.7381 253.283 3.88552 252.663C3.29125 252.231 2.76865 251.709 2.33689 251.115C1.71746 250.262 1.36694 249.182 1.18518 247.505C1.00139 245.808 1.00001 243.622 1.00001 240.6V215H7.15228e-06ZM349 215H350V240.6C350 246.6 350 249.599 348.472 251.702C347.979 252.381 347.381 252.979 346.702 253.472C344.599 255 341.6 255 335.6 255H310V254H335.6C338.622 254 340.808 253.999 342.505 253.815C344.182 253.633 345.262 253.283 346.115 252.663C346.709 252.231 347.231 251.709 347.663 251.115C348.283 250.262 348.633 249.182 348.815 247.505C348.999 245.808 349 243.622 349 240.6V215Z"
              fill="#282D33"
            />
            <path
              d="M135.204 6.036H136.272C136.416 7.392 137.328 8.184 138.816 8.184C140.088 8.184 140.868 7.608 140.868 6.684C140.868 5.58 139.8 5.352 138.432 5.076C136.968 4.788 135.408 4.44 135.408 2.724C135.408 1.248 136.548 0.275999 138.408 0.275999C140.46 0.275999 141.66 1.536 141.792 3.18H140.712C140.592 2.088 139.776 1.236 138.384 1.236C137.256 1.236 136.488 1.836 136.488 2.688C136.488 3.708 137.616 3.936 138.852 4.188C140.436 4.5 141.948 4.848 141.948 6.612C141.948 8.208 140.628 9.144 138.792 9.144C136.62 9.144 135.288 7.848 135.204 6.036ZM142.614 5.76C142.614 3.756 143.85 2.388 145.746 2.388C147.306 2.388 148.422 3.324 148.722 4.776H147.642C147.402 3.876 146.742 3.324 145.746 3.324C144.438 3.324 143.67 4.296 143.67 5.76C143.67 7.224 144.438 8.208 145.758 8.208C146.802 8.208 147.474 7.584 147.678 6.6H148.758C148.494 8.136 147.354 9.144 145.734 9.144C143.85 9.144 142.614 7.764 142.614 5.76ZM150.42 7.26C150.42 7.932 150.972 8.244 151.776 8.244C153.096 8.244 153.96 7.416 153.96 6.336V5.868L151.656 6.276C150.72 6.444 150.42 6.756 150.42 7.26ZM149.34 7.308C149.34 6.288 150.012 5.688 151.512 5.424L153.96 5.004V4.944C153.96 3.888 153.336 3.324 152.256 3.324C151.2 3.324 150.612 3.864 150.468 4.764H149.412C149.544 3.372 150.564 2.388 152.28 2.388C154.008 2.388 155.016 3.384 155.016 5.028V9H154.08L154.044 7.968C153.66 8.64 152.676 9.144 151.536 9.144C150.24 9.144 149.34 8.496 149.34 7.308ZM156.084 9V2.532H157.02L157.056 3.696C157.392 2.868 158.16 2.388 159.18 2.388C160.62 2.388 161.508 3.324 161.508 4.836V9H160.476V5.22C160.476 3.972 159.972 3.324 158.952 3.324C157.848 3.324 157.116 4.08 157.116 5.22V9H156.084ZM164.68 4.716C164.68 1.992 166.324 0.275999 168.796 0.275999C171.292 0.275999 172.936 1.992 172.936 4.716C172.936 6.252 172.42 7.452 171.532 8.208L172.828 9.912H171.484L170.716 8.748C170.152 9 169.516 9.144 168.796 9.144C166.324 9.144 164.68 7.44 164.68 4.716ZM165.76 4.716C165.76 6.852 166.972 8.184 168.796 8.184C170.644 8.184 171.856 6.852 171.856 4.716C171.856 2.556 170.632 1.236 168.796 1.236C166.984 1.236 165.76 2.568 165.76 4.716ZM173.945 9V0.42H177.617C179.561 0.42 180.569 1.344 180.569 2.928C180.569 4.2 179.909 5.04 178.649 5.316L180.821 9H179.609L177.581 5.424H174.977V9H173.945ZM174.977 4.464H177.545C178.841 4.464 179.489 4.02 179.489 2.928C179.489 1.836 178.829 1.38 177.545 1.38H174.977V4.464ZM181.465 6.048V5.112H185.641V6.048H181.465ZM186.501 4.716C186.501 1.992 188.097 0.275999 190.497 0.275999C192.537 0.275999 193.989 1.464 194.385 3.456H193.281C192.933 2.052 191.913 1.236 190.485 1.236C188.745 1.236 187.581 2.568 187.581 4.716C187.581 6.852 188.745 8.184 190.497 8.184C191.985 8.184 193.029 7.272 193.329 5.748H194.433C194.109 7.872 192.633 9.144 190.497 9.144C188.097 9.144 186.501 7.44 186.501 4.716ZM196.205 5.76C196.205 7.224 196.985 8.208 198.293 8.208C199.601 8.208 200.369 7.224 200.369 5.76C200.369 4.308 199.601 3.324 198.293 3.324C196.985 3.324 196.205 4.308 196.205 5.76ZM195.149 5.76C195.149 3.756 196.397 2.388 198.293 2.388C200.189 2.388 201.425 3.756 201.425 5.76C201.425 7.764 200.189 9.144 198.293 9.144C196.397 9.144 195.149 7.764 195.149 5.76ZM207.185 5.748C207.185 4.236 206.417 3.324 205.145 3.324C203.897 3.324 203.201 4.2 203.201 5.76C203.201 7.32 203.897 8.208 205.145 8.208C206.417 8.208 207.185 7.272 207.185 5.748ZM208.193 9H207.257L207.221 7.896C206.837 8.724 205.937 9.144 204.989 9.144C203.285 9.144 202.145 7.788 202.145 5.772C202.145 3.756 203.285 2.388 204.989 2.388C205.937 2.388 206.765 2.808 207.161 3.564V0.18H208.193V9ZM209.106 5.76C209.106 3.756 210.33 2.388 212.202 2.388C214.026 2.388 215.238 3.684 215.238 5.604V6.12H210.174C210.294 7.38 211.038 8.208 212.238 8.208C213.15 8.208 213.774 7.74 214.05 6.96H215.142C214.77 8.292 213.69 9.144 212.214 9.144C210.33 9.144 209.106 7.764 209.106 5.76ZM210.198 5.256H214.158C214.038 4.08 213.354 3.324 212.214 3.324C211.074 3.324 210.354 4.08 210.198 5.256Z"
              fill="url(#paint0_linear_0_1)"
            />
            <defs>
              <linearGradient
                id="paint0_linear_0_1"
                x1="141.451"
                y1="18.9231"
                x2="210.122"
                y2="-25.7312"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#F46919" />
                <stop offset="1" stop-color="#F419AB" />
              </linearGradient>
            </defs>
          </svg>
        </div>
        <div className="text-secondary opacity flex h-12 w-full items-center justify-between rounded-[0.463vw] bg-[#14171C] px-5 text-center text-sm">
          0x9702230a8ea536...3d4df4a8c7
          <CopyButton />
        </div>
      </div>

      <div className="flex flex-col gap-3">
        <div className="text-2xll flex w-full flex-col items-center leading-8">
          1700 USDT
        </div>
        <div className="bg-accent h-px w-full"></div>
        <div className="flex w-full flex-row items-center justify-center gap-1 pb-5 text-sm">
          <span className="text-secondary">Валюта –</span>
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            className="h-4 w-4"
          >
            <g clip-path="url(#clip0_1444_21002)">
              <circle cx="8" cy="8" r="8" fill="#26C5A8" />
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M8.79688 8.27064C8.75246 8.27397 8.52299 8.28766 8.01111 8.28766C7.60397 8.28766 7.31491 8.27545 7.21349 8.27064C5.6401 8.20142 4.4657 7.92753 4.4657 7.5996C4.4657 7.27167 5.6401 6.99815 7.21349 6.92783V7.99785C7.31639 8.00526 7.611 8.02265 8.01814 8.02265C8.5067 8.02265 8.75135 8.0023 8.7954 7.99822V6.92857C10.3655 6.99852 11.5373 7.27241 11.5373 7.5996C11.5373 7.92679 10.3658 8.20068 8.7954 8.27027L8.79688 8.27064ZM8.79727 6.81803V5.86053H10.9884V4.40039H5.02276V5.86053H7.21352V6.81766C5.43285 6.89946 4.09375 7.25219 4.09375 7.67487C4.09375 8.09755 5.43285 8.4499 7.21352 8.53207V11.6004H8.7969V8.53096C10.5735 8.44916 11.9104 8.09681 11.9104 7.6745C11.9104 7.25219 10.5746 6.89983 8.7969 6.81766L8.79727 6.81803Z"
                fill="#0F1217"
              />
            </g>
            <defs>
              <clipPath id="clip0_1444_21002">
                <rect width="16" height="16" rx="8" fill="white" />
              </clipPath>
            </defs>
          </svg>
          Tether (TRC20)
        </div>
      </div>

      
    </FormContainer>
  );
}
