'use client';

import Link from 'next/link';
import { CourseProgress } from '../CourseInfoTopCard/CourseProgress';
import { NotificationsModal } from '../Notifications/NotificationsModal';
import { useNotificationsModalStore } from '~/store/notificationsModal';
import { cn } from '~/lib/utils';
import { useCourseProgressStore } from '~/store/courseProgressStore';
import { api } from '~/trpc/react';

const NotificationButton = ({
  className,
  isActive,
}: {
  className: string;
  isActive: boolean;
}) => {
  const { toggle } = useNotificationsModalStore();

  return (
    <button
      onClick={() => toggle('desktop')}
      className={cn('group cursor-pointer', className)}
    >
      <svg
        width="36"
        height="36"
        viewBox="0 0 36 36"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        className="h-9 w-9"
      >
        <g clipPath="url(#clip0_3635_46750)">
          <rect
            width="36"
            height="36"
            rx="18"
            fill="#F2F2F2"
            className="hidden group-hover:block"
          />

          <path
            d="M15.9987 10.832C14.2827 10.832 12.9515 11.1722 12.0618 12.0618C11.1722 12.9515 10.832 14.2827 10.832 15.9987V19.9987C10.832 21.7147 11.1722 23.0459 12.0618 23.9356C12.9515 24.8252 14.2827 25.1654 15.9987 25.1654H19.9987C21.7147 25.1654 23.0459 24.8252 23.9356 23.9356C24.8252 23.0459 25.1654 21.7147 25.1654 19.9987V16.6654C25.1654 16.3892 24.9415 16.1654 24.6654 16.1654C24.3892 16.1654 24.1654 16.3892 24.1654 16.6654V19.9987C24.1654 21.616 23.8388 22.6181 23.2285 23.2285C22.6181 23.8388 21.616 24.1654 19.9987 24.1654H15.9987C14.3813 24.1654 13.3793 23.8388 12.7689 23.2285C12.1586 22.6181 11.832 21.616 11.832 19.9987V15.9987C11.832 14.3813 12.1586 13.3793 12.7689 12.7689C13.3793 12.1586 14.3813 11.832 15.9987 11.832H19.332C19.6082 11.832 19.832 11.6082 19.832 11.332C19.832 11.0559 19.6082 10.832 19.332 10.832H15.9987Z"
            fill="#F2F2F2"
            className="group-hover:hidden"
          />
          <path
            d="M14.168 18.668C14.168 18.3918 14.3918 18.168 14.668 18.168H18.0013C18.2774 18.168 18.5013 18.3918 18.5013 18.668C18.5013 18.9441 18.2774 19.168 18.0013 19.168H14.668C14.3918 19.168 14.168 18.9441 14.168 18.668Z"
            fill="#F2F2F2"
            className="group-hover:hidden"
          />
          <path
            d="M14.168 21.332C14.168 21.0559 14.3918 20.832 14.668 20.832H20.668C20.9441 20.832 21.168 21.0559 21.168 21.332C21.168 21.6082 20.9441 21.832 20.668 21.832H14.668C14.3918 21.832 14.168 21.6082 14.168 21.332Z"
            fill="#F2F2F2"
            className="group-hover:hidden"
          />
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M24.2383 15.6817C24.2458 15.6799 24.2533 15.678 24.2609 15.678C24.7285 15.5875 25.1659 15.9344 25.1659 16.4171V21.0027C25.1659 21.1083 25.1584 21.2139 25.1509 21.3119C25.1433 21.4024 25.1358 21.4854 25.1207 21.5759C25.1131 21.6664 25.0981 21.7569 25.083 21.8399C24.819 23.6651 23.6575 24.819 21.8399 25.083C21.7569 25.0981 21.6664 25.1131 21.5759 25.1207C21.4854 25.1358 21.4024 25.1433 21.3119 25.1509C21.2139 25.1584 21.1083 25.1659 21.0027 25.1659H14.9992C14.8936 25.1659 14.788 25.1584 14.69 25.1509C14.5994 25.1433 14.5165 25.1358 14.426 25.1207C14.3355 25.1131 14.245 25.0981 14.162 25.083C12.3444 24.819 11.1829 23.6651 10.9189 21.8399C10.9038 21.7569 10.8887 21.6664 10.8812 21.5759C10.8661 21.4854 10.8586 21.4024 10.851 21.3119C10.8435 21.2139 10.8359 21.1083 10.8359 21.0027V14.9992C10.8359 14.8936 10.8435 14.788 10.851 14.69C10.8586 14.5994 10.8661 14.5165 10.8812 14.426C10.8887 14.3355 10.9038 14.245 10.9189 14.162C11.1829 12.3368 12.3444 11.1829 14.162 10.9189C14.245 10.9038 14.3355 10.8887 14.426 10.8812C14.5165 10.8661 14.5994 10.8586 14.69 10.851C14.788 10.8435 14.8936 10.8359 14.9992 10.8359H19.5848C20.0675 10.8359 20.4144 11.2734 20.3239 11.741C20.3239 11.7485 20.322 11.7561 20.3201 11.7636C20.3182 11.7712 20.3164 11.7787 20.3164 11.7862C20.3082 11.8269 20.3023 11.8676 20.2962 11.9095C20.2909 11.9452 20.2856 11.9818 20.2787 12.02C20.2485 12.3368 20.2636 12.6762 20.3314 13.0231C20.3366 13.0438 20.3414 13.0636 20.346 13.083C20.3617 13.1484 20.376 13.208 20.3993 13.272C20.4597 13.5209 20.5577 13.7547 20.6859 13.9735C20.7243 14.0502 20.7735 14.1269 20.8198 14.1991C20.8281 14.212 20.8363 14.2248 20.8443 14.2374C21.0932 14.5994 21.4024 14.9087 21.7644 15.1576C21.7771 15.1656 21.7898 15.1738 21.8028 15.1821C21.8749 15.2284 21.9517 15.2776 22.0284 15.3159C22.2471 15.4442 22.4809 15.5422 22.7298 15.6025C22.7939 15.6258 22.8534 15.6401 22.9189 15.6559C22.9382 15.6605 22.9581 15.6653 22.9787 15.6704C23.3257 15.7383 23.6651 15.7534 23.9818 15.7232C24.02 15.7163 24.0567 15.7109 24.0924 15.7057C24.1343 15.6996 24.175 15.6936 24.2156 15.6855C24.2232 15.6855 24.2307 15.6836 24.2383 15.6817ZM14.668 18.168C14.3918 18.168 14.168 18.3918 14.168 18.668C14.168 18.9441 14.3918 19.168 14.668 19.168H18.0013C18.2774 19.168 18.5013 18.9441 18.5013 18.668C18.5013 18.3918 18.2774 18.168 18.0013 18.168H14.668ZM14.668 20.832C14.3918 20.832 14.168 21.0559 14.168 21.332C14.168 21.6082 14.3918 21.832 14.668 21.832H20.668C20.9441 21.832 21.168 21.6082 21.168 21.332C21.168 21.0559 20.9441 20.832 20.668 20.832H14.668Z"
            fill="#01050D"
            className="hidden group-hover:block"
          />

          <circle
            cx="23.5992"
            cy="12.4"
            r="2.4"
            fill={isActive ? '#CF3336' : '#9AA6B5'}
          />
        </g>
        <rect
          x="0.5"
          y="0.5"
          width="35"
          height="35"
          rx="17.5"
          stroke="#282D33"
        />
        <defs>
          <clipPath id="clip0_3635_46750">
            <rect width="36" height="36" rx="18" fill="white" />
          </clipPath>
        </defs>
      </svg>
    </button>
  );
};
<svg
  width="36"
  height="36"
  viewBox="0 0 36 36"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <g clipPath="url(#clip0_3635_46856)">
    <rect width="36" height="36" rx="18" fill="#F2F2F2" />
    <path
      fillRule="evenodd"
      clipRule="evenodd"
      d="M24.2383 15.6817C24.2458 15.6799 24.2533 15.678 24.2609 15.678C24.7285 15.5875 25.1659 15.9344 25.1659 16.4171V21.0027C25.1659 21.1083 25.1584 21.2139 25.1509 21.3119C25.1433 21.4024 25.1358 21.4854 25.1207 21.5759C25.1131 21.6664 25.0981 21.7569 25.083 21.8399C24.819 23.6651 23.6575 24.819 21.8399 25.083C21.7569 25.0981 21.6664 25.1131 21.5759 25.1207C21.4854 25.1358 21.4024 25.1433 21.3119 25.1509C21.2139 25.1584 21.1083 25.1659 21.0027 25.1659H14.9992C14.8936 25.1659 14.788 25.1584 14.69 25.1509C14.5994 25.1433 14.5165 25.1358 14.426 25.1207C14.3355 25.1131 14.245 25.0981 14.162 25.083C12.3444 24.819 11.1829 23.6651 10.9189 21.8399C10.9038 21.7569 10.8887 21.6664 10.8812 21.5759C10.8661 21.4854 10.8586 21.4024 10.851 21.3119C10.8435 21.2139 10.8359 21.1083 10.8359 21.0027V14.9992C10.8359 14.8936 10.8435 14.788 10.851 14.69C10.8586 14.5994 10.8661 14.5165 10.8812 14.426C10.8887 14.3355 10.9038 14.245 10.9189 14.162C11.1829 12.3368 12.3444 11.1829 14.162 10.9189C14.245 10.9038 14.3355 10.8887 14.426 10.8812C14.5165 10.8661 14.5994 10.8586 14.69 10.851C14.788 10.8435 14.8936 10.8359 14.9992 10.8359H19.5848C20.0675 10.8359 20.4144 11.2734 20.3239 11.741C20.3239 11.7485 20.322 11.7561 20.3201 11.7636C20.3182 11.7712 20.3164 11.7787 20.3164 11.7862C20.3082 11.8269 20.3023 11.8676 20.2962 11.9095C20.2909 11.9452 20.2856 11.9818 20.2787 12.02C20.2485 12.3368 20.2636 12.6762 20.3314 13.0231C20.3366 13.0438 20.3414 13.0636 20.346 13.083C20.3617 13.1484 20.376 13.208 20.3993 13.272C20.4597 13.5209 20.5577 13.7547 20.6859 13.9735C20.7243 14.0502 20.7735 14.1269 20.8198 14.1991C20.8281 14.212 20.8363 14.2248 20.8443 14.2374C21.0932 14.5994 21.4024 14.9087 21.7644 15.1576C21.7771 15.1656 21.7898 15.1738 21.8028 15.1821C21.8749 15.2284 21.9517 15.2776 22.0284 15.3159C22.2471 15.4442 22.4809 15.5422 22.7298 15.6025C22.7939 15.6258 22.8534 15.6401 22.9189 15.6559C22.9382 15.6605 22.9581 15.6653 22.9787 15.6704C23.3257 15.7383 23.6651 15.7534 23.9818 15.7232C24.02 15.7163 24.0567 15.7109 24.0924 15.7057C24.1343 15.6996 24.175 15.6936 24.2156 15.6855C24.2232 15.6855 24.2307 15.6836 24.2383 15.6817ZM14.668 18.168C14.3918 18.168 14.168 18.3918 14.168 18.668C14.168 18.9441 14.3918 19.168 14.668 19.168H18.0013C18.2774 19.168 18.5013 18.9441 18.5013 18.668C18.5013 18.3918 18.2774 18.168 18.0013 18.168H14.668ZM14.668 20.832C14.3918 20.832 14.168 21.0559 14.168 21.332C14.168 21.6082 14.3918 21.832 14.668 21.832H20.668C20.9441 21.832 21.168 21.6082 21.168 21.332C21.168 21.0559 20.9441 20.832 20.668 20.832H14.668Z"
      fill="#01050D"
    />
    <circle cx="23.5992" cy="12.4" r="2.4" fill="#CF3336" />
  </g>
  <defs>
    <clipPath id="clip0_3635_46856">
      <rect width="36" height="36" rx="18" fill="white" />
    </clipPath>
  </defs>
</svg>;

const BackButton = () => {
  return (
    <svg
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      className="h-6 w-6 cursor-pointer hover:opacity-80"
    >
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M11.099 6.46967C10.8061 6.17678 10.3312 6.17678 10.0383 6.46967L5.03831 11.4696C4.89766 11.6103 4.81864 11.801 4.81864 11.9999C4.81864 12.1989 4.89766 12.3896 5.03831 12.5303L10.0383 17.5303C10.3312 17.8232 10.8061 17.8232 11.099 17.5303C11.3919 17.2374 11.3919 16.7625 11.099 16.4696L7.3793 12.75H18.4258C18.84 12.75 19.1758 12.4142 19.1758 12C19.1758 11.5857 18.84 11.25 18.4258 11.25H7.37931L11.099 7.53033C11.3919 7.23744 11.3919 6.76257 11.099 6.46967Z"
        fill="#F2F2F2"
      />
    </svg>
  );
};
export default function LessonSidebarHeader({
  courseTitle,
}: {
  courseTitle: string;
}) {
  const { courseProgress } = useCourseProgressStore();
  const unreadCount = api.notifications.getUnreadCount.useQuery();

  return (
    <>
      <div className="bg-background sticky top-0 z-10 flex flex-row items-center px-8 pt-8 pb-5 text-base font-medium">
        <Link
          href="/dashboard"
          className="flex items-center justify-center gap-2 hover:opacity-50"
        >
          <BackButton />
          <span className="line-clamp-1 flex-1 overflow-hidden wrap-break-word text-ellipsis">
            {courseTitle}
          </span>
        </Link>
        <NotificationButton
          isActive={(unreadCount?.data || 0) > 0}
          className="ml-8 h-9 w-9"
        />
      </div>
      <div className="relative flex flex-col">
        <div className="">
          <CourseProgress
            progress={courseProgress}
            className="bg-[#0B0D12] px-8 py-5"
            progressClassName="h-2"
          />
        </div>

        <NotificationsModal />
      </div>
    </>
  );
}
